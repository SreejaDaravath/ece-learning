<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#6366f1">
    <title>‚ö° ECE CHAMPIONS - Master Hardcore Electronics Projects</title>
    <meta name="description" content="Build real-world ECE projects: 4-bit ALU, 8-bit CPU, RAM circuits, Timers, ADC/DAC. Professional gaming platform for serious electronics engineers!">
    <meta name="keywords" content="ECE projects, 4-bit ALU, 8-bit CPU, digital circuits, RAM design, electronics gaming, circuit challenges">
    <meta name="author" content="ECE Champions Team">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://sreejadaravath.github.io/ece-learning/">
    <meta property="og:title" content="ECE CHAMPIONS - Master Hardcore Projects">
    <meta property="og:description" content="Build 4-bit ALU, 8-bit CPU, RAM circuits! Professional gaming platform for serious ECE engineers.">
    <meta property="og:image" content="https://sreejadaravath.github.io/ece-learning/preview.png">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://sreejadaravath.github.io/ece-learning/">
    <meta name="twitter:title" content="ECE CHAMPIONS - Master Hardcore Projects">
    <meta name="twitter:description" content="Build 4-bit ALU, 8-bit CPU, RAM circuits! Professional gaming platform for serious ECE engineers.">
    <meta name="twitter:image" content="https://sreejadaravath.github.io/ece-learning/preview.png">
    
    <link rel="stylesheet" href="ece-champions.css?v=20251105v1">
    <link rel="manifest" href="manifest.json">
    
    <!-- Google Analytics (Privacy-focused) - Replace G-XXXXXXXXXX with your tracking ID -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        // Initialize Google Analytics only if user consents
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        
        // Check for consent in localStorage
        const analyticsConsent = localStorage.getItem('analytics-consent');
        if (analyticsConsent === 'true') {
            gtag('js', new Date());
            gtag('config', 'G-XXXXXXXXXX', {
                'anonymize_ip': true,
                'cookie_flags': 'SameSite=None;Secure'
            });
        }
        
        // Custom event tracking
        window.trackEvent = function(category, action, label, value) {
            if (analyticsConsent === 'true' && typeof gtag !== 'undefined') {
                gtag('event', action, {
                    'event_category': category,
                    'event_label': label,
                    'value': value
                });
            }
        };
        
        // Error tracking
        window.addEventListener('error', function(e) {
            console.error('Application error:', e.error);
            if (typeof trackEvent !== 'undefined') {
                trackEvent('Error', 'JavaScript Error', e.message, 0);
            }
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Unhandled promise rejection:', e.reason);
            if (typeof trackEvent !== 'undefined') {
                trackEvent('Error', 'Promise Rejection', e.reason, 0);
            }
        });
    </script>
</head>
<body>
    <!-- Skip link for keyboard users -->
    <a class="skip-link" href="#main" style="position:absolute;left:-999px;top:auto;" onfocus="this.style.left='10px'" onblur="this.style.left='-999px'">Skip to content</a>
    
    <!-- Privacy Notice / Cookie Consent Banner -->
    <div class="privacy-banner hidden" id="privacyBanner">
        <div class="privacy-content">
            <p>üç™ We use analytics to improve your learning experience. Your data is anonymized and secure.</p>
            <div class="privacy-actions">
                <button class="privacy-btn accept" id="acceptAnalytics">Accept & Continue</button>
                <button class="privacy-btn decline" id="declineAnalytics">Decline</button>
                <a href="#" class="privacy-link" id="learnMorePrivacy">Learn More</a>
            </div>
        </div>
    </div>
    <!-- üéÆ Game Header -->
    <header class="game-header" role="banner">
        <div class="header-left">
            <h1>‚ö° ECE MASTER</h1>
            <div class="level-badge">
                <span class="module-name" id="moduleName">Basic Electronics</span>
                <span class="level-number">Level <span id="levelNum">1</span>/50</span>
            </div>
        </div>
        <div class="header-center">
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
                <span class="progress-text" id="progressText">0%</span>
            </div>
        </div>
        <div class="header-right">
            <div class="score-display">
                <span class="score-label">Score:</span>
                <span class="score-value" id="scoreValue">0</span>
            </div>
            <div class="lang-select" style="margin-left:10px;">
                <label for="lang" class="visually-hidden">Language</label>
                <select id="lang" aria-label="Language selector">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
                </select>
            </div>
            <div class="score-display">
                <span class="score-label">High:</span>
                <span class="score-value gold" id="highScore">0</span>
            </div>
        </div>
    </header>

    <!-- üéØ Main Game Container -->
    <div class="game-container">
        
        <!-- Left Panel - Component Palette -->
        <aside class="component-palette">
            <h3>üîß Components</h3>
            <div class="palette-section" id="componentsList">
                <!-- Components will be dynamically loaded -->
            </div>
            
            <div class="palette-divider"></div>
            
            <h3>üìä Tools</h3>
            <div class="tools-section">
                <button class="tool-btn" id="multimeterBtn">
                    <span class="tool-icon">üî¥</span>
                    <span class="tool-name">Multimeter</span>
                </button>
                <button class="tool-btn" id="logicAnalyzerBtn">
                    <span class="tool-icon">üìà</span>
                    <span class="tool-name">Logic Analyzer</span>
                </button>
                <button class="tool-btn" id="oscilloscopeBtn">
                    <span class="tool-icon">„Ä∞Ô∏è</span>
                    <span class="tool-name">Oscilloscope</span>
                </button>
            </div>

            <div class="palette-divider"></div>
            
            <div class="quick-actions">
                <button class="action-btn wire-btn" id="drawWireBtn">
                    <span>üîå</span> Draw Wire
                </button>
                <button class="action-btn clear-btn" id="clearCircuit">
                    <span>üóëÔ∏è</span> Clear All
                </button>
                <button class="action-btn hint-btn" id="getHint">
                    <span>üí°</span> Hint (-25pts)
                </button>
                <button class="action-btn assistant-btn" id="eceAssistant" aria-label="ECE AI Assistant with Webcam">
                    <span>üìπ</span> ECE Assistant
                </button>
            </div>
        </aside>

        <!-- Center Panel - Workspace -->
        <main class="workspace">
            <!-- Task Description -->
            <div class="task-panel" id="taskPanel">
                <div class="task-header">
                    <h2 class="task-title" id="taskTitle">Connect Your First LED</h2>
                    <div class="timer" id="timer">
                        <span class="timer-icon">‚è±Ô∏è</span>
                        <span class="timer-value" id="timerValue">60s</span>
                    </div>
                </div>
                <p class="task-description" id="taskDescription">
                    Drag a battery and LED. Connect them. Watch it glow! ‚ö°
                </p>
                <div class="task-goal">
                    <strong>Goal:</strong> <span id="taskGoal">Make the LED glow</span>
                </div>
            </div>

            <!-- Demo Panel (shows at level start) -->
            <div class="demo-panel hidden" id="demoPanel">
                <div class="demo-header">
                    <h3>üì∫ Watch Demo (10 seconds)</h3>
                    <div class="demo-timer" id="demoTimer">10s</div>
                </div>
                <canvas id="demoCanvas" width="400" height="300" role="img" aria-label="Demo circuit animation" tabindex="0"></canvas>
                <button class="skip-demo-btn" id="skipDemo">Skip Demo ‚è≠Ô∏è</button>
            </div>

            <!-- Breadboard Canvas -->
            <div class="breadboard-container" id="breadboardContainer">
                <canvas id="breadboard" width="800" height="600" role="img" aria-label="Breadboard workspace" tabindex="0"></canvas>
                
                <!-- Measurement Overlay -->
                <div class="measurement-overlay hidden" id="measurementOverlay">
                    <div class="measurement-box">
                        <div class="measurement-title">üìä Measurement</div>
                        <div class="measurement-value" id="measurementValue">--</div>
                        <button class="close-measurement" id="closeMeasurement">‚úï</button>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="control-panel" role="region" aria-label="Level controls">
                <button class="control-btn prev-btn" id="prevLevel" title="Previous Level" aria-label="Previous level">
                    <span class="btn-icon">‚Üê</span>
                    <span class="btn-text">Previous</span>
                </button>
                <button class="control-btn demo-btn" id="watchDemo" title="Watch demonstration" aria-label="Watch demo">
                    <span class="btn-icon">üì∫</span>
                    <span class="btn-text">Watch Demo</span>
                </button>
                <button class="control-btn answer-btn" id="showAnswer" title="Auto-build circuit (-50 points)" aria-label="Show answer (costs 50 points)">
                    <span class="btn-icon">üëÅÔ∏è</span>
                    <span class="btn-text">Show Answer</span>
                </button>
                <button class="control-btn test-btn" id="testCircuit" title="Test your circuit" aria-label="Test circuit">
                    <span class="btn-icon">üß™</span>
                    <span class="btn-text">Test Circuit</span>
                </button>
                <button class="control-btn submit-btn" id="submitAnswer" title="Submit your answer" aria-label="Submit answer">
                    <span class="btn-icon">‚úì</span>
                    <span class="btn-text">Submit</span>
                </button>
                <button class="control-btn retry-btn hidden" id="retryLevel" title="Retry this level" aria-label="Retry level">
                    <span class="btn-icon">üîÑ</span>
                    <span class="btn-text">Retry</span>
                </button>
                <button class="control-btn next-btn hidden" id="nextLevel" title="Next level" aria-label="Next level">
                    <span class="btn-icon">‚Üí</span>
                    <span class="btn-text">Next Level</span>
                </button>
            </div>

            <!-- Feedback Panel -->
            <div class="feedback-panel hidden" id="feedbackPanel">
                <div class="feedback-content" id="feedbackContent">
                    <!-- Feedback will be shown here -->
                </div>
            </div>
        </main>

        <!-- Right Panel - Info & Stats -->
        <aside class="info-panel">
            <h3>üìà Current Status</h3>
            
            <div class="stat-card">
                <div class="stat-label">Phase</div>
                <div class="stat-value" id="phaseStatus">Learn</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Attempts</div>
                <div class="stat-value" id="attemptsValue">0/3</div>
            </div>

            <div class="stat-card">
                <div class="stat-label">Time Taken</div>
                <div class="stat-value" id="timeTaken">0s</div>
            </div>

            <div class="divider"></div>

            <h3>üéØ Measurements</h3>
            <div class="measurements-list" id="measurementsList">
                <div class="measurement-item">
                    <span class="measure-label">Voltage:</span>
                    <span class="measure-value" id="voltageDisplay">--</span>
                </div>
                <div class="measurement-item">
                    <span class="measure-label">Current:</span>
                    <span class="measure-value" id="currentDisplay">--</span>
                </div>
                <div class="measurement-item">
                    <span class="measure-label">Resistance:</span>
                    <span class="measure-value" id="resistanceDisplay">--</span>
                </div>
                <div class="measurement-item">
                    <span class="measure-label">Power:</span>
                    <span class="measure-value" id="powerDisplay">--</span>
                </div>
            </div>

            <div class="divider"></div>

            <h3>üèÜ Achievements</h3>
            <div class="achievements-list" id="achievementsList">
                <div class="achievement-badge locked">
                    <span class="badge-icon">üéì</span>
                    <span class="badge-name">Scholar</span>
                </div>
                <div class="achievement-badge locked">
                    <span class="badge-icon">‚ö°</span>
                    <span class="badge-name">Speed Demon</span>
                </div>
                <div class="achievement-badge locked">
                    <span class="badge-icon">üéØ</span>
                    <span class="badge-name">Perfectionist</span>
                </div>
                <div class="achievement-badge locked">
                    <span class="badge-icon">üî•</span>
                    <span class="badge-name">Hot Streak</span>
                </div>
            </div>

            <div class="divider"></div>

            <button class="reset-btn" id="resetProgress">
                <span>üîÑ</span> Reset Progress
            </button>
        </aside>
    </div>

    <!-- üéâ Success Modal -->
    <div class="modal hidden" id="successModal">
        <div class="modal-content success">
            <div class="modal-header">
                <h2>üéâ Level Complete!</h2>
            </div>
            <div class="modal-body">
                <div class="score-breakdown">
                    <div class="score-item">
                        <span>Base Score:</span>
                        <span class="score-points" id="baseScore">+100</span>
                    </div>
                    <div class="score-item">
                        <span>Time Bonus:</span>
                        <span class="score-points" id="timeBonus">+50</span>
                    </div>
                    <div class="score-item">
                        <span>First Attempt:</span>
                        <span class="score-points" id="attemptBonus">+100</span>
                    </div>
                    <div class="score-item total">
                        <span>Total:</span>
                        <span class="score-points" id="totalScore">+250</span>
                    </div>
                </div>
                <div class="new-achievement" id="newAchievement"></div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" id="continueBtn">Continue ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- üîß Hint Modal -->
    <div class="modal hidden" id="hintModal">
        <div class="modal-content hint">
            <div class="modal-header">
                <h2>üí° Hint</h2>
                <button class="close-modal" id="closeHint">‚úï</button>
            </div>
            <div class="modal-body">
                <p class="hint-text" id="hintText"></p>
            </div>
        </div>
    </div>

    <!-- üìä Multimeter Modal -->
    <div class="modal hidden" id="multimeterModal">
        <div class="modal-content multimeter">
            <div class="modal-header">
                <h2>üî¥ Multimeter</h2>
                <button class="close-modal" id="closeMultimeter">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="multimeter-display">
                    <div class="display-screen">
                        <span class="display-value" id="multimeterReading">0.00</span>
                        <span class="display-unit" id="multimeterUnit">V</span>
                    </div>
                </div>
                <div class="multimeter-controls">
                    <button class="meter-mode-btn active" data-mode="voltage">Voltage (V)</button>
                    <button class="meter-mode-btn" data-mode="current">Current (A)</button>
                    <button class="meter-mode-btn" data-mode="resistance">Resistance (Œ©)</button>
                </div>
                <p class="meter-instruction">Click two points on the circuit to measure</p>
            </div>
        </div>
    </div>

    <!-- üìπ ECE Assistant Webcam Modal -->
    <div class="modal hidden" id="eceAssistantModal">
        <div class="modal-content assistant">
            <div class="modal-header">
                <h2>üìπ ECE AI Assistant</h2>
                <button class="close-modal" id="closeAssistant">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="assistant-container">
                    <div class="webcam-section">
                        <video id="assistantWebcam" width="320" height="240" autoplay style="border-radius: 8px; background: #000;"></video>
                        <canvas id="assistantCanvas" width="320" height="240" style="display:none;"></canvas>
                        <div class="webcam-controls">
                            <button class="webcam-btn" id="startWebcam">
                                <span>üì∑</span> Start Camera
                            </button>
                            <button class="webcam-btn hidden" id="captureCircuit">
                                <span>üì∏</span> Capture Circuit
                            </button>
                            <button class="webcam-btn hidden" id="stopWebcam">
                                <span>‚èπÔ∏è</span> Stop Camera
                            </button>
                        </div>
                    </div>
                    <div class="assistant-feedback">
                        <h3>ü§ñ AI Analysis</h3>
                        <div class="assistant-message" id="assistantMessage">
                            <p>üëã Hi! I'm your ECE Assistant. I can help you:</p>
                            <ul>
                                <li>‚úÖ Check if your circuit is correct</li>
                                <li>üí° Give hints about component placement</li>
                                <li>üîç Identify missing connections</li>
                                <li>üìö Explain circuit concepts</li>
                            </ul>
                            <p style="margin-top:15px; color: #666; font-size: 0.9em;">
                                <strong>How to use:</strong><br>
                                1. Click "Start Camera" to enable your webcam<br>
                                2. Show your circuit to the camera<br>
                                3. Click "Capture Circuit" for instant feedback<br>
                                4. Get smart hints to complete the level!
                            </p>
                        </div>
                    </div>
                </div>
                <div class="assistant-tips">
                    <strong>üí° Quick Tips:</strong>
                    <div class="tip-grid">
                        <button class="tip-btn" data-tip="components">Show All Components</button>
                        <button class="tip-btn" data-tip="connections">Check Connections</button>
                        <button class="tip-btn" data-tip="values">Verify Values</button>
                        <button class="tip-btn" data-tip="theory">Explain Theory</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="levels-data.js?v=20251103v4"></script>
    <script src="game-engine.js?v=20251103v4"></script>
    <script src="onboarding.js?v=20251103v5"></script>
    <script src="advanced-learning.js?v=20251103v5"></script>
    
    <!-- ECE Assistant Webcam Functionality -->
    <script>
        // ECE Assistant Manager
        const ECEAssistant = {
            stream: null,
            video: null,
            canvas: null,
            ctx: null,
            
            init() {
                this.video = document.getElementById('assistantWebcam');
                this.canvas = document.getElementById('assistantCanvas');
                this.ctx = this.canvas.getContext('2d');
                
                // Button handlers
                document.getElementById('eceAssistant').addEventListener('click', () => {
                    document.getElementById('eceAssistantModal').classList.remove('hidden');
                });
                
                document.getElementById('closeAssistant').addEventListener('click', () => {
                    this.stopCamera();
                    document.getElementById('eceAssistantModal').classList.add('hidden');
                });
                
                document.getElementById('startWebcam').addEventListener('click', () => this.startCamera());
                document.getElementById('stopWebcam').addEventListener('click', () => this.stopCamera());
                document.getElementById('captureCircuit').addEventListener('click', () => this.captureAndAnalyze());
                
                // Tip buttons
                document.querySelectorAll('.tip-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tip = e.target.dataset.tip;
                        this.showTip(tip);
                    });
                });
            },
            
            async startCamera() {
                try {
                    this.stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { width: 320, height: 240 } 
                    });
                    this.video.srcObject = this.stream;
                    
                    document.getElementById('startWebcam').classList.add('hidden');
                    document.getElementById('captureCircuit').classList.remove('hidden');
                    document.getElementById('stopWebcam').classList.remove('hidden');
                    
                    this.updateMessage('üìπ Camera active! Position your circuit in the frame and click "Capture Circuit"', 'success');
                } catch (err) {
                    console.error('Camera access error:', err);
                    this.updateMessage('‚ùå Camera access denied. Please allow camera permissions or use Quick Tips below.', 'error');
                }
            },
            
            stopCamera() {
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                    this.video.srcObject = null;
                    this.stream = null;
                    
                    document.getElementById('startWebcam').classList.remove('hidden');
                    document.getElementById('captureCircuit').classList.add('hidden');
                    document.getElementById('stopWebcam').classList.add('hidden');
                }
            },
            
            captureAndAnalyze() {
                // Capture frame from video
                this.ctx.drawImage(this.video, 0, 0, 320, 240);
                
                // Simulate AI analysis (in production, this would call a real AI model)
                this.updateMessage('üîÑ Analyzing your circuit...', 'info');
                
                setTimeout(() => {
                    this.performAnalysis();
                }, 1500);
            },
            
            performAnalysis() {
                // Get current level info from game engine
                const currentLevel = window.game ? window.game.currentLevel : null;
                
                if (!currentLevel) {
                    this.updateMessage('‚ö†Ô∏è Please load a level first!', 'warning');
                    return;
                }
                
                // Simulate intelligent feedback based on circuit state
                const feedback = this.generateFeedback(currentLevel);
                this.updateMessage(feedback, 'success');
            },
            
            generateFeedback(level) {
                const tips = [
                    `üéØ <strong>Circuit Analysis Complete!</strong><br><br>
                    ‚úÖ <strong>Level Goal:</strong> ${level.goal || 'Complete the circuit'}<br><br>
                    üí° <strong>Smart Hints:</strong><br>
                    ‚Ä¢ Make sure all components are properly connected<br>
                    ‚Ä¢ Check the polarity of your components (+ and -)<br>
                    ‚Ä¢ Verify wire connections are complete<br>
                    ‚Ä¢ Use the Test Circuit button to validate<br><br>
                    <strong>Need more help?</strong> Click the Hint button for detailed guidance!`,
                    
                    `üîç <strong>Component Check:</strong><br><br>
                    ‚Ä¢ Required components detected ‚úì<br>
                    ‚Ä¢ Double-check component orientations<br>
                    ‚Ä¢ Ensure proper power supply connections<br><br>
                    üí™ You're on the right track! Keep going!`,
                    
                    `‚ö° <strong>Circuit Status:</strong><br><br>
                    ‚Ä¢ Components: Looking good!<br>
                    ‚Ä¢ Connections: Review your wiring<br>
                    ‚Ä¢ Power flow: Check positive/negative terminals<br><br>
                    üéì Remember: Current flows from + to -`,
                ];
                
                return tips[Math.floor(Math.random() * tips.length)];
            },
            
            showTip(tipType) {
                const currentLevel = window.game ? window.game.currentLevel : null;
                
                const tips = {
                    components: `üì¶ <strong>Components for this level:</strong><br><br>
                        ${currentLevel && currentLevel.components ? 
                          currentLevel.components.map(c => `‚Ä¢ ${c.type}: ${c.value || ''}`).join('<br>') :
                          'Components will appear in the palette on the left'}<br><br>
                        Drag them onto the breadboard to start building!`,
                    
                    connections: `üîå <strong>Connection Tips:</strong><br><br>
                        ‚Ä¢ Click "Draw Wire" to connect components<br>
                        ‚Ä¢ Connect positive (+) to positive terminals<br>
                        ‚Ä¢ Connect negative (-) to ground or negative terminals<br>
                        ‚Ä¢ Complete the circuit path for current to flow<br><br>
                        ‚ö° Tip: Use the multimeter to verify connections!`,
                    
                    values: `üìä <strong>Component Values:</strong><br><br>
                        ‚Ä¢ Check resistor color codes<br>
                        ‚Ä¢ Verify voltage ratings on power supplies<br>
                        ‚Ä¢ Use the multimeter to measure actual values<br>
                        ‚Ä¢ Ensure capacitor polarities are correct<br><br>
                        üéØ Goal: ${currentLevel ? currentLevel.goal : 'Complete the circuit correctly'}`,
                    
                    theory: `üìö <strong>Circuit Theory:</strong><br><br>
                        <strong>Ohm's Law:</strong> V = I √ó R<br>
                        ‚Ä¢ V (Voltage) = Electrical pressure<br>
                        ‚Ä¢ I (Current) = Flow of electrons<br>
                        ‚Ä¢ R (Resistance) = Opposition to flow<br><br>
                        <strong>Kirchhoff's Laws:</strong><br>
                        ‚Ä¢ Voltage Law: Sum of voltages in a loop = 0<br>
                        ‚Ä¢ Current Law: Current in = Current out<br><br>
                        üí° Apply these principles to solve the level!`
                };
                
                this.updateMessage(tips[tipType] || 'Feature coming soon!', 'info');
            },
            
            updateMessage(html, type = 'info') {
                const messageDiv = document.getElementById('assistantMessage');
                messageDiv.innerHTML = html;
                messageDiv.className = 'assistant-message ' + type;
            }
        };
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            ECEAssistant.init();
            PrivacyManager.init();
        });
    </script>
    
    <!-- Privacy & Analytics Manager -->
    <script>
        const PrivacyManager = {
            init() {
                const consent = localStorage.getItem('analytics-consent');
                
                // Show banner if user hasn't made a choice
                if (consent === null) {
                    setTimeout(() => {
                        document.getElementById('privacyBanner').classList.remove('hidden');
                    }, 2000); // Show after 2 seconds
                }
                
                // Button handlers
                document.getElementById('acceptAnalytics').addEventListener('click', () => {
                    this.setConsent(true);
                    this.trackEvent('Privacy', 'Analytics Consent', 'Accepted', 1);
                });
                
                document.getElementById('declineAnalytics').addEventListener('click', () => {
                    this.setConsent(false);
                });
                
                document.getElementById('learnMorePrivacy').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showPrivacyInfo();
                });
            },
            
            setConsent(accepted) {
                localStorage.setItem('analytics-consent', accepted.toString());
                document.getElementById('privacyBanner').classList.add('hidden');
                
                if (accepted) {
                    // Reload analytics
                    location.reload();
                }
            },
            
            showPrivacyInfo() {
                const info = `
                    <div style="padding: 20px; background: var(--bg-card); border-radius: 12px;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üîí Privacy Policy</h3>
                        <p style="line-height: 1.6; margin-bottom: 15px;">
                            <strong>We respect your privacy!</strong> Here's what we collect:
                        </p>
                        <ul style="line-height: 1.8; margin-left: 20px;">
                            <li>‚úÖ Anonymous usage statistics (levels completed, time spent)</li>
                            <li>‚úÖ Technical data (browser, device type, screen size)</li>
                            <li>‚úÖ Error reports to improve stability</li>
                            <li>‚ùå NO personal information (name, email, etc.)</li>
                            <li>‚ùå NO tracking across websites</li>
                            <li>‚ùå NO selling your data</li>
                        </ul>
                        <p style="line-height: 1.6; margin-top: 15px; color: var(--text-secondary);">
                            <strong>Your IP is anonymized.</strong> All data is secure and used only to improve the learning experience.
                            You can change your choice anytime by clearing browser data.
                        </p>
                    </div>
                `;
                
                const messageDiv = document.getElementById('assistantMessage');
                if (messageDiv) {
                    messageDiv.innerHTML = info;
                    messageDiv.className = 'assistant-message info';
                    document.getElementById('eceAssistantModal').classList.remove('hidden');
                } else {
                    alert(info.replace(/<[^>]*>/g, ''));
                }
            },
            
            trackEvent(category, action, label, value) {
                if (window.trackEvent) {
                    window.trackEvent(category, action, label, value);
                }
            }
        };
        
        // Track level completions
        window.trackLevelComplete = function(levelNum, score, time) {
            if (window.trackEvent) {
                trackEvent('Gameplay', 'Level Complete', `Level ${levelNum}`, score);
                trackEvent('Gameplay', 'Completion Time', `Level ${levelNum}`, time);
            }
        };
        
        // Track feature usage
        window.trackFeatureUse = function(featureName) {
            if (window.trackEvent) {
                trackEvent('Features', 'Feature Used', featureName, 1);
            }
        };
    </script>
    
    <!-- Simple Learning Platform: AI Tutor, Simulation, Webcam -->
    <script src="simple-learning.js?v=20251104v3"></script>
    
    <!-- Measurement Tools: Multimeter, Oscilloscope, Logic Analyzer -->
    <script src="measurement-tools.js?v=20251104v1"></script>
    
    <script>
        // Register service worker for offline support (graceful if not supported)
        if ('serviceWorker' in navigator) {
            try {
                navigator.serviceWorker.register('/service-worker.js');
                console.log('Service worker registered');
            } catch (err) {
                console.warn('Service worker registration failed', err);
            }
        }
    </script>
</body>
</html>
